{
  "hash": "d93fcbe07d5f263b469e8166c7715c89",
  "result": {
    "markdown": "---\ntitle: \"Upgrading R version with all your packages\"\ndescription: \"Learn how to do a painless upgrade of your R version\"\ndate: 2022-05-06\nauthor: \n  - name: Fabrício Almeida-Silva\n    orcid: 0000-0002-5314-2964\ndraft: false\nimage: upgrade.gif\ncategories:\n  - rstats\n  - project management\n---\n\n\n## Motivation\n\nHave you ever upgraded R and lost all of your packages? As a consequence,\nyou had to install them again one by one. One. By. One. Oh, man... Boring, huh?\nHere, I will guide you on how to upgrade your R version and reinstall your \npackages automatically. This way, you can spend your time on what really \nmatters: writing some cool R code! This post is inspired by \n[this Gist code](https://gist.github.com/jthomasmock/65366b9c1fd750347b9de1d2c80ed827).\n\n\n## 'Taking a picture' of your current R package universe\n\nThe first thing you need to do before upgrading your R version is to save\na list of all packages you have installed. Not only must you have package names,\nbut also from where they were downloaded (e.g., CRAN, Bioconductor, GitHub,\netc.). The code below will create a data frame of packages and their sources,\nand save it as a .csv file in your current working directory.\n\n**NOTE:** You need to have the packages `tidyverse` and `sessioninfo` installed.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#----Create a data frame with all installed packages and their sources---------\nlibrary(tidyverse)\nall_pkg <- sessioninfo::session_info(\"installed\") |> \n  pluck(\"packages\") |> \n  as_tibble()\n\n# Classify sources: CRAN, Bioconductor, GitHub, r-universe, and local\nsplit_repo <- all_pkg |> \n    mutate(repo = case_when(\n        str_detect(source, \"Bioconductor\") ~ \"Bioconductor\",\n        str_detect(source, \"CRAN\") ~ \"CRAN\",\n        str_detect(source, \"Github\") ~ \"GitHub\",\n        str_detect(source, \"local\") ~ \"local\",\n        str_detect(source, \"r-universe\") ~ \"r-universe\",\n        TRUE ~ NA_character_\n    ), .before = \"source\") |>\n    select(package, repo)\n\nhead(split_repo)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 2\n  package          repo        \n  <chr>            <chr>       \n1 abind            CRAN        \n2 ade4             CRAN        \n3 annotate         Bioconductor\n4 AnnotationDbi    Bioconductor\n5 AnnotationFilter Bioconductor\n6 ape              CRAN        \n```\n:::\n:::\n\n\nYou can then export this data frame to a .csv file as follows:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsplit_repo |> \n  write_csv(\"packages.csv\")\n```\n:::\n\n\nNow that you have a list of all your packages and their sources, you can\ninstall the latest version of R. That will vary according to the operating \nsystem you use, so you'd better go to the [CRAN page](https://cran.rstudio.com/)\nand see the instructions on how to upgrade R for your case. In my case,\non a Ubuntu 20.04 LTS machine, I just ran:\n\n\n::: {.cell}\n\n```{.bash .cell-code}\nsudo apt-get update\nsudo apt-get upgrade\n```\n:::\n\n\nOnce you're done upgrading your R version, open a new R session (now with\nthe latest version) and run the following code to install all your beloved\npackages:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#----First, install tidyverse, remotes, and BiocManager-------------------------\nif(!require(\"tidyverse\", quietly = TRUE))\n    install.packages(\"tidyverse\")\n\nif(!require(\"remotes\", quietly = TRUE))\n    install.packages(\"remotes\")\n\nif(!require(\"BiocManager\", quietly = TRUE))\n    install.packages(\"BiocManager\")\n\n#----Read data frame with package names and sources-----------------------------\nlibrary(tidyverse)\nall_pkg <- readr::read_csv(\"packages.csv\", show_col_types = FALSE)\n\n#----Reinstall packages---------------------------------------------------------\n## CRAN packages\ncran_pkg <- all_pkg |> \n  dplyr::filter(repo == \"CRAN\") |> \n  dplyr::pull(package)\n\ncran_pkg |>\n  install.packages()\n\n\n## Bioconductor packages\nbioc_pkg <- all_pkg |>\n    dplyr::filter(repo == \"Bioconductor\") |>\n    dplyr::pull(package)\n\nbioc_pkg |>\n    BiocManager::install()\n\n\n## R-Universe\nruni_pkg <- all_pkg |>\n    dplyr::filter(repo == \"r-universe\") |>\n    dplyr::pull(package)\n\nruni_pkg |>\n    install.packages(repos = \"https://ropensci.r-universe.dev\")\n\n\n## GitHub packages - only list packages\ngh_pkg <- all_pkg |>\n    dplyr::filter(repo == \"GitHub\") |>\n    dplyr::pull(package)\n```\n:::\n\n\nFor GitHub packages, I suggest looking at them one by one (there shouldn't be\nmany of them) and deciding which ones you want to install, as many of them\nare usually unstable and installed for testing purposes. Once you have\nidentified which ones you want to install, you can do it \nwith `remotes::install_github()`.\n\nAnd that's all! Whenever you need to upgrade R, just run the same code again\nand you're all set. I hope this post helped you!\n\n## Session information\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsessioninfo::session_info()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n─ Session info ───────────────────────────────────────────────────────────────\n setting  value\n version  R version 4.3.0 (2023-04-21)\n os       Ubuntu 20.04.5 LTS\n system   x86_64, linux-gnu\n ui       X11\n language (EN)\n collate  en_US.UTF-8\n ctype    en_US.UTF-8\n tz       Europe/Brussels\n date     2023-06-12\n pandoc   3.1.1 @ /usr/lib/rstudio/resources/app/bin/quarto/bin/tools/ (via rmarkdown)\n\n─ Packages ───────────────────────────────────────────────────────────────────\n package     * version date (UTC) lib source\n bit           4.0.5   2022-11-15 [1] CRAN (R 4.3.0)\n bit64         4.0.5   2020-08-30 [1] CRAN (R 4.3.0)\n cli           3.6.1   2023-03-23 [1] CRAN (R 4.3.0)\n colorspace    2.1-0   2023-01-23 [1] CRAN (R 4.3.0)\n crayon        1.5.2   2022-09-29 [1] CRAN (R 4.3.0)\n digest        0.6.31  2022-12-11 [1] CRAN (R 4.3.0)\n dplyr       * 1.1.2   2023-04-20 [1] CRAN (R 4.3.0)\n evaluate      0.20    2023-01-17 [1] CRAN (R 4.3.0)\n fansi         1.0.4   2023-01-22 [1] CRAN (R 4.3.0)\n fastmap       1.1.1   2023-02-24 [1] CRAN (R 4.3.0)\n forcats     * 1.0.0   2023-01-29 [1] CRAN (R 4.3.0)\n generics      0.1.3   2022-07-05 [1] CRAN (R 4.3.0)\n ggplot2     * 3.4.2   2023-04-03 [1] CRAN (R 4.3.0)\n glue          1.6.2   2022-02-24 [1] CRAN (R 4.3.0)\n gtable        0.3.3   2023-03-21 [1] CRAN (R 4.3.0)\n hms           1.1.3   2023-03-21 [1] CRAN (R 4.3.0)\n htmltools     0.5.5   2023-03-23 [1] CRAN (R 4.3.0)\n htmlwidgets   1.6.2   2023-03-17 [1] CRAN (R 4.3.0)\n jsonlite      1.8.4   2022-12-06 [1] CRAN (R 4.3.0)\n knitr         1.42    2023-01-25 [1] CRAN (R 4.3.0)\n lifecycle     1.0.3   2022-10-07 [1] CRAN (R 4.3.0)\n lubridate   * 1.9.2   2023-02-10 [1] CRAN (R 4.3.0)\n magrittr      2.0.3   2022-03-30 [1] CRAN (R 4.3.0)\n munsell       0.5.0   2018-06-12 [1] CRAN (R 4.3.0)\n pillar        1.9.0   2023-03-22 [1] CRAN (R 4.3.0)\n pkgconfig     2.0.3   2019-09-22 [1] CRAN (R 4.3.0)\n purrr       * 1.0.1   2023-01-10 [1] CRAN (R 4.3.0)\n R6            2.5.1   2021-08-19 [1] CRAN (R 4.3.0)\n readr       * 2.1.4   2023-02-10 [1] CRAN (R 4.3.0)\n rlang         1.1.1   2023-04-28 [1] CRAN (R 4.3.0)\n rmarkdown     2.21    2023-03-26 [1] CRAN (R 4.3.0)\n rstudioapi    0.14    2022-08-22 [1] CRAN (R 4.3.0)\n scales        1.2.1   2022-08-20 [1] CRAN (R 4.3.0)\n sessioninfo   1.2.2   2021-12-06 [1] CRAN (R 4.3.0)\n stringi       1.7.12  2023-01-11 [1] CRAN (R 4.3.0)\n stringr     * 1.5.0   2022-12-02 [1] CRAN (R 4.3.0)\n tibble      * 3.2.1   2023-03-20 [1] CRAN (R 4.3.0)\n tidyr       * 1.3.0   2023-01-24 [1] CRAN (R 4.3.0)\n tidyselect    1.2.0   2022-10-10 [1] CRAN (R 4.3.0)\n tidyverse   * 2.0.0   2023-02-22 [1] CRAN (R 4.3.0)\n timechange    0.2.0   2023-01-11 [1] CRAN (R 4.3.0)\n tzdb          0.3.0   2022-03-28 [1] CRAN (R 4.3.0)\n utf8          1.2.3   2023-01-31 [1] CRAN (R 4.3.0)\n vctrs         0.6.2   2023-04-19 [1] CRAN (R 4.3.0)\n vroom         1.6.3   2023-04-28 [1] CRAN (R 4.3.0)\n withr         2.5.0   2022-03-03 [1] CRAN (R 4.3.0)\n xfun          0.39    2023-04-20 [1] CRAN (R 4.3.0)\n yaml          2.3.7   2023-01-23 [1] CRAN (R 4.3.0)\n\n [1] /home/faalm/R/x86_64-pc-linux-gnu-library/4.3\n [2] /usr/local/lib/R/site-library\n [3] /usr/lib/R/site-library\n [4] /usr/lib/R/library\n\n──────────────────────────────────────────────────────────────────────────────\n```\n:::\n:::",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}